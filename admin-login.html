<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - Rservas.Roma</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://resource.trickle.so/vendor_lib/unpkg/lucide-static@0.516.0/font/lucide.css" rel="stylesheet">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-amber-900 min-h-screen flex items-center justify-center p-4">
    
    <!-- Redirecci√≥n autom√°tica si ya hay sesi√≥n -->
    <script>
        (function() {
            const isAdmin = localStorage.getItem('adminAuth') === 'true';
            const profesionalAuth = localStorage.getItem('profesionalAuth');
            
            if (isAdmin || profesionalAuth) {
                console.log('üîê Sesi√≥n activa detectada, redirigiendo a admin.html');
                window.location.replace('admin.html');
            }
        })();
    </script>

    <div class="bg-gray-800 rounded-2xl shadow-xl max-w-md w-full p-8 animate-fade-in border border-amber-700">
        <div class="text-center mb-8">
            <!-- LOGO -->
            <div class="flex justify-center mb-4">
                <div class="w-20 h-20 bg-gradient-to-br from-amber-500 to-amber-700 rounded-2xl shadow-xl flex items-center justify-center transform rotate-3 hover:rotate-0 transition-transform duration-300">
                    <i class="icon-scissors text-4xl text-white"></i>
                </div>
            </div>
            
            <!-- Eslogan -->
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-amber-600/30 backdrop-blur-sm border border-amber-500/50 text-amber-300 text-sm font-medium mb-2">
                <i class="icon-star text-xs"></i>
                <span>Nivel que se nota</span>
            </div>
            
            <h1 class="text-3xl font-bold text-white">Rservas.Roma</h1>
            <p class="text-amber-400">Acceso al Panel</p>
        </div>
        
        <div id="mensaje" class="mb-4 text-sm text-center hidden"></div>
        
        <form id="loginForm" class="space-y-6">
            <div>
                <label class="block text-sm font-medium text-amber-400 mb-2">Email</label>
                <input type="email" id="username" required
                       class="w-full px-4 py-3 rounded-lg border border-gray-600 bg-gray-700 text-white focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none transition"
                       placeholder="tuduenna@email.com">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-amber-400 mb-2">Contrase√±a</label>
                <input type="password" id="password" required
                       class="w-full px-4 py-3 rounded-lg border border-gray-600 bg-gray-700 text-white focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none transition"
                       placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            
            <button type="submit" 
                    class="w-full bg-gradient-to-r from-amber-600 to-amber-700 text-white py-3 rounded-lg font-semibold hover:from-amber-700 hover:to-amber-800 transition transform hover:scale-105">
                Entrar
            </button>
        </form>
        
        <div id="errorMsg" class="mt-4 text-red-500 text-sm text-center hidden"></div>
    </div>

    <!-- Scripts con rutas relativas y timestamp -->
    <script type="text/javascript" src="utils/supabase-config.js?v=202402261533"></script>
    <script type="text/javascript" src="utils/config.js?v=202402261534"></script>
    <script type="text/javascript" src="utils/storage.js?v=202402261530"></script>

    <script type="text/javascript">
        console.log('üîç VERIFICACI√ìN INICIAL LOGIN:');
        console.log('  window.location.pathname:', window.location.pathname);
        console.log('  window.location.origin:', window.location.origin);
        console.log('  SUPABASE_URL:', window.SUPABASE_URL);
        console.log('  SUPABASE_ANON_KEY:', window.SUPABASE_ANON_KEY ? '‚úì Definida' : '‚úó Undefined');
        
        if (!window.SUPABASE_URL) {
            console.error('‚ùå ERROR CR√çTICO: SUPABASE_URL no est√° definida en login');
        } else {
            console.log('‚úÖ Supabase configurado correctamente en login');
        }
    </script>

    <script type="text/javascript" src="utils/api.js?v=202402261530"></script>
    <script type="text/javascript" src="utils/timeLogic.js?v=202402261530"></script>
    <script type="text/javascript" src="utils/auth-clients.js?v=202402261530"></script>
    <script type="text/javascript" src="utils/auth-barberos.js?v=202402261530"></script>
    <script type="text/javascript" src="utils/servicios.js?v=202402261530"></script>
    <script type="text/javascript" src="utils/profesionales.js?v=202402261530"></script>

    <script type="text/javascript">
        console.log('üîç VERIFICACI√ìN DE CARGA LOGIN:');
        console.log(' ‚úÖ supabase-config:', window.SUPABASE_URL ? 'OK' : 'FALTA');
        console.log(' ‚úÖ SUPABASE_URL:', window.SUPABASE_URL);
        console.log(' ‚úÖ auth-barberos:', typeof window.verificarBarberoPorTelefono);
        console.log(' ‚úÖ auth-clientes:', typeof window.verificarAccesoCliente);
        console.log(' ‚úÖ loginBarbero:', typeof window.loginBarbero);
        console.log(' ‚úÖ salonConfig:', typeof window.salonConfig);
        console.log(' ‚úÖ salonServicios:', typeof window.salonServicios);
        console.log(' ‚úÖ salonProfesionales:', typeof window.salonProfesionales);
    </script>


        
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const errorMsg = document.getElementById('errorMsg');
            const mensaje = document.getElementById('mensaje');
            
            errorMsg.classList.add('hidden');
            mensaje.classList.add('hidden');
            
            mensaje.textContent = 'Verificando...';
            mensaje.classList.remove('hidden');
            mensaje.classList.add('text-amber-400', 'bg-gray-700', 'p-2', 'rounded-lg');
            
            try {
                console.log('üîê Intentando login con Supabase Auth:', email);
                
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                console.log('‚úÖ Login exitoso:', data);
                
                localStorage.setItem('adminAuth', 'true');
                localStorage.setItem('adminUser', email);
                localStorage.setItem('adminLoginTime', Date.now());
                localStorage.setItem('userRole', 'admin');
                
                mensaje.classList.add('hidden');
                window.location.href = 'admin.html';
                
            } catch (error) {
                console.error('‚ùå Error en login:', error);
                errorMsg.textContent = 'Email o contrase√±a incorrectos';
                errorMsg.classList.remove('hidden');
                mensaje.classList.add('hidden');
            }
        });
    </script>
</body>
</html>